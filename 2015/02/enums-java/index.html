<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Uso avanzado de enumerados
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="Raúl Ávila" href="/atom.xml">

</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <h1 class="masthead-title">
          <a href="/" title="Home">Raúl Ávila</a>
        </h1>

            <small><a href="/sobre-mi">Sobre mí</a></small>
            &nbsp;&nbsp;&nbsp;
            <small><a href="/archivos">Archivos</a></small>
      </header>

      <main>
        <article class="post">
  <h1 class="post-title">Uso avanzado de enumerados</h1>
  <time datetime="2015-02-18T00:00:00+00:00" class="post-date">18/02/2015</time>
  <div class="post-tags">
    
    | <a href="/tag/Java">Java</a> |
    
    | <a href="/tag/enums">enums</a> |
    
    | <a href="/tag/desarrollo">desarrollo</a> |
    
  </div>
  <div class="post-share">
    <a class="twitter-share-button"
    data-via="_Raul_Avila"
    data-count="none"
    href="https://twitter.com/share">Tweet</a>
  </div>
  <p><a href="http://docs.oracle.com/javase/7/docs/api/java/lang/Enum.html">Los tipos enumerados de Java</a> (<code class="highlighter-rouge">enum</code>) fueron añadidos en la versión 5 del lenguaje. Su uso más inmediato fue el de “contenedores de constantes”, y me temo que gran parte de los desarrolladores desconocen la flexibilidad que permiten más allá de este típico uso:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">EmployeeType</span> <span class="o">{</span>
    <span class="n">ENGINEER</span><span class="o">,</span>
    <span class="n">MANAGER</span><span class="o">,</span>
    <span class="n">SALESMAN</span><span class="o">;</span>
<span class="o">}</span>
 </code></pre></figure>

<!--break-->

<p>También es bastante normal que se utilicen de una forma algo más avanzada, asignando parámetros a cada valor enumerado:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">EmployeeType</span> <span class="o">{</span>
    <span class="n">ENGINEER</span><span class="o">(</span><span class="s">"Engineer"</span><span class="o">,</span> <span class="mi">30000</span><span class="o">),</span>
    <span class="n">MANAGER</span><span class="o">(</span><span class="s">"Manager"</span><span class="o">,</span> <span class="mi">40000</span><span class="o">),</span>
    <span class="n">SALESMAN</span><span class="o">(</span><span class="s">"Salesman"</span><span class="o">,</span> <span class="mi">50000</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">value</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">salary</span><span class="o">;</span>

    <span class="n">EmployeeType</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span> <span class="n">salary</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">salary</span> <span class="o">=</span> <span class="n">salary</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="n">getValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="n">getSalary</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">salary</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>En el ejemplo se asigna un nombre “para mostrar” (<code class="highlighter-rouge">toString()</code> por defecto sacaría el valor del enumerado tal cual, en letras mayúsculas) y un salario a cada tipo de empleado.</p>

<p>Mi intención con este post es dar a conocer usos más avanzados de los enumerados, que yo personalmente utilizo bastante a menudo y de formas quizás menos ortodoxas.</p>

<p>(<a href="https://github.com/raulavila/enums-examples">Como siempre el código está en GitHub</a>)</p>

<h3 id="enums-como-estados-con-comportamiento-asociado">Enums como estados con comportamiento asociado</h3>

<p>Los enumerados me parecen una de las formas más claras y elegantes de implementar <a href="http://en.wikipedia.org/wiki/State_pattern">el patrón State</a>. En el siguiente ejemplo creamos una clase <em>Calculator</em> de una sola operación, y que expone dos métodos, <code class="highlighter-rouge">setOperation</code>, para cambiar la operación (el estado) de la calculadora, y <code class="highlighter-rouge">performOperation</code>, que recibe dos números y devuelve el resultado de aplicar la operación:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Calculator</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Operation</span> <span class="n">operation</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Calculator</span><span class="o">(</span><span class="n">Operation</span> <span class="n">operation</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">operation</span> <span class="o">=</span> <span class="n">operation</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="n">performOperation</span><span class="o">(</span><span class="kt">int</span> <span class="n">operand1</span><span class="o">,</span>
                                <span class="kt">int</span> <span class="n">operand2</span><span class="o">)</span> <span class="o">{</span>

        <span class="k">return</span> <span class="n">operation</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">operand1</span><span class="o">,</span> <span class="n">operand2</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="n">setOperation</span><span class="o">(</span><span class="n">Operation</span> <span class="n">operation</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">operation</span> <span class="o">=</span> <span class="n">operation</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
  </code></pre></figure>

<p>Como vemos, la clase no tiene ni idea de como se implementan las operaciones, delegando su ejecución a la instancia de Operation:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Operation</span> <span class="o">{</span>
    <span class="n">ADD</span><span class="o">(</span><span class="s">"+"</span><span class="o">)</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">perform</span><span class="o">(</span><span class="kt">int</span> <span class="n">operand1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">operand2</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">operand1</span> <span class="o">+</span> <span class="n">operand2</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">},</span>
    <span class="n">SUBSTRACT</span><span class="o">(</span><span class="s">"-"</span><span class="o">){</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">perform</span><span class="o">(</span><span class="kt">int</span> <span class="n">operand1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">operand2</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">operand1</span> <span class="o">-</span> <span class="n">operand2</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">},</span>
    <span class="n">MULTIPLY</span><span class="o">(</span><span class="s">"*"</span><span class="o">){</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">perform</span><span class="o">(</span><span class="kt">int</span> <span class="n">operand1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">operand2</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">operand1</span> <span class="o">*</span> <span class="n">operand2</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">},</span>
    <span class="n">DIVIDE</span><span class="o">(</span><span class="s">"/"</span><span class="o">){</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">perform</span><span class="o">(</span><span class="kt">int</span> <span class="n">operand1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">operand2</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">operand1</span> <span class="o">/</span> <span class="n">operand2</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">};</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">operator</span><span class="o">;</span>

    <span class="n">Operation</span><span class="o">(</span><span class="n">String</span> <span class="n">operator</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">operator</span> <span class="o">=</span> <span class="n">operator</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="n">getOperator</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">operator</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">int</span> <span class="n">perform</span><span class="o">(</span><span class="kt">int</span> <span class="n">operand1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">operand2</span><span class="o">);</span>
<span class="o">}</span>
   </code></pre></figure>

<p>Aquí es donde se ve de forma clara cómo encapsulamos cada operación en las distintas instancias de Operation dentro del método <code class="highlighter-rouge">perform</code>, que a nivel de clase está declarado como método abstracto (ya que se implementa en cada uno de los enumerados). También exponemos un atributo, <code class="highlighter-rouge">operator</code>, que no es más que el símbolo que identifica a cada operación, aunque en el ejemplo no se utiliza.</p>

<p>El método <code class="highlighter-rouge">perform</code> podría haber contenido una implementación por defecto, de forma que si luego no la sobrescribimos en las instancias sería la ejecutada por el compilador:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Operation</span> <span class="o">{</span>
   <span class="c1">//....</span>
   <span class="n">VERY_COMPLEX_OPERATION</span><span class="o">;</span>
   <span class="c1">//....</span>
   <span class="kd">public</span> <span class="kt">int</span> <span class="n">perform</span><span class="o">(</span><span class="kt">int</span> <span class="n">operand1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">operand2</span><span class="o">){</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="n">UnsupportedOperationException</span><span class="o">();</span>
   <span class="o">}</span>
<span class="o">}</span>
 </code></pre></figure>

<p>En este ejemplo podemos declarar una operación y no implementarla de momento, mientras que con la primera versión no sería posible.</p>

<p>Como es de esperar la calculadora funciona según lo esperado:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Calculator</span> <span class="n">calculator</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Calculator</span><span class="o">(</span><span class="n">Operation</span><span class="o">.</span><span class="na">ADD</span><span class="o">);</span>

<span class="n">assertThat</span><span class="o">(</span><span class="n">calculator</span><span class="o">.</span><span class="na">performOperation</span><span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">2</span><span class="o">)).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">10</span><span class="o">);</span>

<span class="n">calculator</span><span class="o">.</span><span class="na">setOperation</span><span class="o">(</span><span class="n">Operation</span><span class="o">.</span><span class="na">SUBSTRACT</span><span class="o">);</span>

<span class="n">assertThat</span><span class="o">(</span><span class="n">calculator</span><span class="o">.</span><span class="na">performOperation</span><span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">2</span><span class="o">)).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">6</span><span class="o">);</span>
  </code></pre></figure>

<h3 id="estados-asociados">Estados asociados</h3>

<p>Siguiendo con el patrón State, es posible asociar estados de la misma enumeración entre sí, con la única condición de que no es posible referenciar un valor del enumerado que aún no ha sido declarado:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">enum</span> <span class="n">OvenState</span> <span class="o">{</span>

    <span class="n">END</span><span class="o">(</span><span class="s">"Oven finished cooking"</span><span class="o">,</span> <span class="kc">null</span><span class="o">),</span>
    <span class="n">COOLING</span><span class="o">(</span><span class="s">"Oven is cooling"</span><span class="o">,</span> <span class="n">END</span><span class="o">),</span>
    <span class="n">COOKING</span><span class="o">(</span><span class="s">"Oven is cooking"</span><span class="o">,</span> <span class="n">COOLING</span><span class="o">),</span>
    <span class="n">HEATING</span><span class="o">(</span><span class="s">"Oven is heating"</span><span class="o">,</span> <span class="n">COOKING</span><span class="o">),</span>
    <span class="n">BEGIN</span><span class="o">(</span><span class="s">"Oven is starting"</span><span class="o">,</span> <span class="n">HEATING</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">value</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">OvenState</span> <span class="n">next</span><span class="o">;</span>

    <span class="n">OvenState</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">,</span> <span class="n">OvenState</span> <span class="n">next</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">next</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="n">getValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">OvenState</span> <span class="n">getNext</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">next</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">hasNext</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">next</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
 </code></pre></figure>

<p>En el ejemplo defino estados de un horno imaginario, de forma que cada estado contiene una referencia de su estado siguiente. Debido a la restricción comentada más arriba, no es posible declarar los estados como sería más natural, de BEGIN a END, porque en tal caso el compilador se quejaría.</p>

<p>La implementación del horno con su estado quedaría:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Oven</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">OvenState</span> <span class="n">state</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">Oven</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">reset</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="n">reset</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">OvenState</span><span class="o">.</span><span class="na">BEGIN</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="n">click</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">hasFinished</span><span class="o">())</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalStateException</span><span class="o">(</span>
                    <span class="s">"Oven has finished cooking"</span><span class="o">);</span>

        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="na">getNext</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="n">getState</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">state</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">hasFinished</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="n">state</span><span class="o">.</span><span class="na">hasNext</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>De nuevo el horno no tiene ni idea de todos los estados por los que pasa, solo sabe que hay un estado inicial, y que existe un estado final según el valor devuelto por <code class="highlighter-rouge">hasFinished</code>.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Oven</span> <span class="n">oven</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Oven</span><span class="o">();</span>
<span class="n">assertThat</span><span class="o">(</span><span class="n">oven</span><span class="o">.</span><span class="na">getState</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"Oven is starting"</span><span class="o">);</span>

<span class="n">oven</span><span class="o">.</span><span class="na">click</span><span class="o">();</span>
<span class="n">assertThat</span><span class="o">(</span><span class="n">oven</span><span class="o">.</span><span class="na">getState</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"Oven is heating"</span><span class="o">);</span>

<span class="n">oven</span><span class="o">.</span><span class="na">click</span><span class="o">();</span>
<span class="n">assertThat</span><span class="o">(</span><span class="n">oven</span><span class="o">.</span><span class="na">getState</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"Oven is cooking"</span><span class="o">);</span>

<span class="n">oven</span><span class="o">.</span><span class="na">click</span><span class="o">();</span>
<span class="n">assertThat</span><span class="o">(</span><span class="n">oven</span><span class="o">.</span><span class="na">getState</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"Oven is cooling"</span><span class="o">);</span>

<span class="n">oven</span><span class="o">.</span><span class="na">click</span><span class="o">();</span>
<span class="n">assertThat</span><span class="o">(</span><span class="n">oven</span><span class="o">.</span><span class="na">getState</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"Oven finished cooking"</span><span class="o">);</span>

<span class="n">assertThat</span><span class="o">(</span><span class="n">oven</span><span class="o">.</span><span class="na">hasFinished</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">();</span>

<span class="k">try</span> <span class="o">{</span>
    <span class="n">oven</span><span class="o">.</span><span class="na">click</span><span class="o">();</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IllegalStateException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span>
            <span class="s">"Oven has finished cooking"</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">oven</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
<span class="n">assertThat</span><span class="o">(</span><span class="n">oven</span><span class="o">.</span><span class="na">getState</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"Oven is starting"</span><span class="o">);</span></code></pre></figure>

<p>Siguiendo con mi manía de desacoplar al máximo, ¡el horno ni siquiera tendría por qué saber el valor del estado inicial! Para eso habría que declarar un método estátido en OvenState:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">OvenState</span> <span class="nf">getInitialState</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">BEGIN</span><span class="o">;</span>
<span class="o">}</span></code></pre></figure>

<p>Y en Oven:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">reset</span><span class="p">(</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">OvenState</span><span class="o">.</span><span class="na">getInitialState</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

<p>Esto ya queda al gusto de cada uno, pero yo prefiero esta última versión.</p>

<h3 id="enums-como-parametrizaciones">Enums como parametrizaciones</h3>

<p>Imaginemos un sistema que contiene una serie de parámetros de configuración a persistir en una base de datos o similar. Dichos parámetros pueden contener diversos tipos de datos, pero en la tabla el tipo del valor será un String para dar flexibilidad, es decir, tendremos algo como:</p>

<table>
    <thead>
        <tr>
            <th>
               PARAM_NAME : STRING
            </th>
            <th>
               PARAM_VALUE : STRING
            </th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>
               systemName
            </td>
            <td>
               Inventory
            </td>
        </tr>
        <tr>
            <td>
              concurrentUsers
            </td>
            <td>
               100
            </td>
        </tr>
    </tbody>
</table>

<p>Aunque el tipo de PARAM_VALUE sea un String, es evidente que cada parámetro tiene una naturaleza muy concreta (podemos tener fechas, enteros, cadenas, etc). Nos gustaría que nuestra clase DAO que persiste esta información chequeara el tipo de los datos antes de almacenarlos. Además queremos que los nombres de los parámetros estuvieran acotados a una serie muy concreta.</p>

<p>Diría que no hay mejor forma de hacer esto que utilizando un enumerado:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">ConfigParam</span> <span class="o">{</span>

    <span class="n">SYSTEM_NAME</span><span class="o">(</span><span class="s">"systemName"</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">),</span>
    <span class="n">CONCURRENT_USERS</span><span class="o">(</span><span class="s">"concurrentUsers"</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">paramName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">type</span><span class="o">;</span>

    <span class="n">ConfigParam</span><span class="o">(</span><span class="n">String</span> <span class="n">paramName</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">paramName</span> <span class="o">=</span> <span class="n">paramName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">type</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="n">hasValidTypeFor</span><span class="o">(</span><span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">type</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="n">getParamName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">paramName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="n">getTypeName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">type</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<p>Como vemos, cada instancia contiene el nombre del parámetro a persistir, y la clase del valor. El propio enumerado expone un método que chequea si un objeto en concreto contiene un valor válido para el parámetro.</p>

<p>La clase DAO, por tanto, delegaría toda la lógica al valor del enumerado que quiera almacenar el cliente:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">ConfigDAO</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="n">save</span><span class="o">(</span><span class="n">ConfigParam</span> <span class="n">param</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">AbstractConfigDAO</span> <span class="kd">implements</span> <span class="n">ConfigDAO</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">save</span><span class="o">(</span><span class="n">ConfigParam</span> <span class="n">param</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">validate</span><span class="o">(</span><span class="n">param</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>

        <span class="n">doSave</span><span class="o">(</span><span class="n">param</span><span class="o">.</span><span class="na">getParamName</span><span class="o">(),</span> <span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="n">validate</span><span class="o">(</span><span class="n">ConfigParam</span> <span class="n">param</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Validate</span><span class="o">.</span><span class="na">notNull</span><span class="o">(</span><span class="n">param</span><span class="o">,</span> <span class="s">"Param can't be null"</span><span class="o">);</span>
        <span class="n">Validate</span><span class="o">.</span><span class="na">notNull</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="s">"Value can't be null"</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(!</span><span class="n">param</span><span class="o">.</span><span class="na">hasValidTypeFor</span><span class="o">(</span><span class="n">value</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="o">(</span>
                    <span class="n">param</span><span class="o">.</span><span class="na">getParamName</span><span class="o">()+</span>
                            <span class="s">" value must be an instance of "</span> <span class="o">+</span>
                            <span class="n">param</span><span class="o">.</span><span class="na">getTypeName</span><span class="o">());</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">protected</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="n">doSave</span><span class="o">(</span><span class="n">String</span> <span class="n">paramName</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">);</span>
<span class="o">}</span></code></pre></figure>

<p>La clase <code class="highlighter-rouge">AbstractConfigDAO</code> es una implementación del <a href="http://en.wikipedia.org/wiki/Template_method_pattern">Template method pattern</a>, y sería necesario completar el “algoritmo” con una implementación concreta del método <code class="highlighter-rouge">doSave</code>. En el código para este ejemplo me olvido por completo de almacenar nada (el cometido de este post no es hablar de persistencia de datos en Java :) ),por lo que he creado una implementación Dummy:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">DummyConfigDAO</span> <span class="kd">extends</span> <span class="n">AbstractConfigDAO</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="n">doSave</span><span class="o">(</span><span class="n">String</span> <span class="n">paramName</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Saving param "</span> <span class="o">+</span> <span class="n">paramName</span> <span class="o">+</span>
                                <span class="s">" with value "</span> <span class="o">+</span> <span class="n">value</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
 </code></pre></figure>

<p>En los tests se ve muy bien lo claro que quedan los clientes utilizando esta aproximación:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testCorrectSystemName</span><span class="p">(</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">configDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">ConfigParam</span><span class="o">.</span><span class="na">SYSTEM_NAME</span><span class="o">,</span> <span class="s">"mySystem"</span><span class="o">);</span>
<span class="o">}</span>

<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testIncorrectSystemName</span><span class="p">(</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">expectedException</span><span class="o">.</span><span class="na">expect</span><span class="o">(</span><span class="n">IllegalArgumentException</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">expectedException</span><span class="o">.</span><span class="na">expectMessage</span><span class="o">(</span>
            <span class="s">"systemName value must be an instance of String"</span><span class="o">);</span>

    <span class="n">configDAO</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">ConfigParam</span><span class="o">.</span><span class="na">SYSTEM_NAME</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
<span class="o">}</span>
 </code></pre></figure>

<h3 id="conclusin">Conclusión</h3>

<p>Espero que con este post haya quedado demostradada la flexibilidad de los enumerados en Java, y la claridad que dan al código si se usan convenientemente. Me he dejado algún uso en el tintero, como puede ser la implementación del patrón Singleton, <a href="http://javarevisited.blogspot.co.uk/2012/07/why-enum-singleton-are-better-in-java.html">pero este tema ya está cubierto de sobra.</a></p>

</article>

<aside class="related">
  <h2>Posts relacionados</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2016/07/antipatrones-arquitectura">
            Antipatrones de Arquitectura Software
            <small><time datetime="2016-07-10T00:00:00+01:00">10/07/2016</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2016/06/concourse-3/">
            Integración continua con Concourse CI&#58; un pipeline real
            <small><time datetime="2016-06-21T00:00:00+01:00">21/06/2016</time></small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2016/05/concourse-2/">
            Integración continua con Concourse CI&#58; conceptos avanzados
            <small><time datetime="2016-05-28T00:00:00+01:00">28/05/2016</time></small>
          </a>
        </h3>
      </li>
    
  </ul>
</aside>

        
<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'raulavila'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2016">2016</time> Raúl Ávila. Blog creado con <a href="http://jekyllrb.com">Jekyll</a>.
          Plantilla basada en <a href="http://getpoole.com">Poole</a>.
          <a href="/atom.xml">Atom Feed</a></a>.
          <br>
        </small>
      </footer>
    </div>

  <script>
window.twttr=(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);t._e=[];t.ready=function(f){t._e.push(f);};return t;}(document,"script","twitter-wjs"));
</script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58942569-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
</html>
